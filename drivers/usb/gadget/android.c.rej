--- drivers/usb/gadget/android.c	2017-03-12 21:44:09.000000000 -0500
+++ drivers/usb/gadget/android.c	2017-05-08 21:34:59.000000000 -0500
@@ -732,9 +745,13 @@
 {
 	struct usb_composite_dev *cdev = dev->cdev;
 	struct android_configuration *conf;
+	bool do_put = false;
 
 	if (dev->disable_depth++ == 0) {
+		if (cdev->suspended && cdev->config) {
 		usb_gadget_autopm_get(cdev->gadget);
+			do_put = true;
+		}
 		if (gadget_is_dwc3(cdev->gadget)) {
 			/* Cancel pending control requests */
 			usb_ep_dequeue(cdev->gadget->ep0, cdev->req);
@@ -753,6 +770,7 @@
 			list_for_each_entry(conf, &dev->configs, list_item)
 				usb_remove_config(cdev, &conf->usb_config);
 		}
+		if (do_put)
 		usb_gadget_autopm_put_async(cdev->gadget);
 	}
 }
